<!DOCTYPE html>
<html lang="en">

<head>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-0Q1VZ5TT2T"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-0Q1VZ5TT2T');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Actor Details</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="styles5.css">
</head>

<body>
    <header>
        <nav>
            <a href="index.html">Home</a>
        </nav>
    </header>

    <main>
        <div class="banner" id="actor-banner">
            <div class="banner-overlay"></div>
            <div class="small-banner" id="actor-small-banner"></div>
        </div>
        <div class="actor-details">
            <h1 id="actor-name"></h1>
            <div class="actor-info">
                <p><strong>Age:</strong> <span id="actor-age"></span></p>
                <p><strong>Known For:</strong> <span id="actor-known-for"></span></p>
            </div>
        </div>

        <section class="content-section black-layout" id="combined-credits">
            <h2>Movies / TV Shows ft. <span id="actor-name-heading"></span></h2>
            <div class="grid" id="combined-credits-grid"></div>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 FireFlix. All rights reserved.</p>
    </footer>

    <script>
        const apiKey = '7967738a03ec215c7d6d675faba9c973';
        const urlParams = new URLSearchParams(window.location.search);
        const actorId = urlParams.get('actor_id');

        async function fetchActorDetails(actorId) {
            try {
                const response = await fetch(`https://api.themoviedb.org/3/person/${actorId}?api_key=${apiKey}&language=en-US`);
                const data = await response.json();
                displayActorDetails(data);
                fetchCombinedCredits(actorId);
            } catch (error) {
                console.error("Error fetching actor details: ", error);
            }
        }

        function displayActorDetails(actor) {
            const actorBanner = document.getElementById('actor-banner');
            const actorSmallBanner = document.getElementById('actor-small-banner');
            const actorName = document.getElementById('actor-name');
            const actorNameHeading = document.getElementById('actor-name-heading');
            const actorAge = document.getElementById('actor-age');
            const actorKnownFor = document.getElementById('actor-known-for');

            actorBanner.style.backgroundImage = `url(https://image.tmdb.org/t/p/w1280${actor.profile_path})`;
            actorSmallBanner.style.backgroundImage = `url(https://image.tmdb.org/t/p/w500${actor.profile_path})`;
            actorName.textContent = actor.name;
            actorNameHeading.textContent = actor.name;
            actorAge.textContent = calculateAge(actor.birthday);
            actorKnownFor.textContent = actor.known_for_department;
        }

        function calculateAge(birthday) {
            const birthDate = new Date(birthday);
            const today = new Date();
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            return age;
        }

        async function fetchCombinedCredits(actorId) {
            try {
                const response = await fetch(`https://api.themoviedb.org/3/person/${actorId}/combined_credits?api_key=${apiKey}&language=en-US`);
                const data = await response.json();
                displayCombinedCredits(data.cast);
            } catch (error) {
                console.error("Error fetching combined credits: ", error);
            }
        }

        function displayCombinedCredits(credits) {
            const combinedCreditsGrid = document.getElementById('combined-credits-grid');
            combinedCreditsGrid.innerHTML = '';
            credits.filter(item => item.poster_path || item.backdrop_path).forEach(item => {
                const div = document.createElement('div');
                const img = document.createElement('img');
                img.src = `https://image.tmdb.org/t/p/w500${item.poster_path || item.backdrop_path}`;
                img.alt = item.title || item.name;
                div.appendChild(img);

                div.addEventListener('click', async () => {
                    const imdbId = await fetchIMDbID(item.id, item.media_type || (item.first_air_date ? 'tv' : 'movie'));
                    window.location.href = `movie.html?imdb_id=${imdbId}`;
                });

                combinedCreditsGrid.appendChild(div);
            });
        }

        async function fetchIMDbID(tmdbId, type) {
            try {
                const response = await fetch(`https://api.themoviedb.org/3/${type}/${tmdbId}/external_ids?api_key=${apiKey}`);
                const data = await response.json();
                return data.imdb_id;
            } catch (error) {
                console.error(`Error fetching IMDb ID for ${type} with TMDB ID ${tmdbId}: `, error);
            }
        }

        if (actorId) {
            fetchActorDetails(actorId);
        }
    </script>
</body>

</html>