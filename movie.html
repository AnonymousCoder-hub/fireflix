<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-0Q1VZ5TT2T"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-0Q1VZ5TT2T');
  </script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Movie Details - FireFlix</title>
  <link rel="icon" type="image/x-icon" href="logo.ico">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="styles3.css">
</head>
<body>

  <!-- Modern Header -->
  <header class="modern-header">
    <nav class="navbar">
      <div class="nav-left">
        <a href="index.html" class="logo">
          <svg class="logo-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
          </svg>
          <span>FireFlix</span>
        </a>
      </div>
      <div class="nav-right">
        <a href="index.html" class="back-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="19" y1="12" x2="5" y2="12"></line>
            <polyline points="12 19 5 12 12 5"></polyline>
          </svg>
          Back
        </a>
      </div>
    </nav>
  </header>

  <main>
    <!-- Hero Banner -->
    <div class="movie-banner" id="banner">
      <div class="banner-overlay"></div>
      <div class="banner-content">
        <div class="banner-left">
          <div class="poster-wrapper" id="poster-wrapper">
            <!-- Poster will be inserted here -->
          </div>
        </div>
        <div class="banner-right">
          <h1 class="movie-title" id="movie-title"></h1>

          <div class="movie-meta">
            <div class="rating-badge" id="rating-badge">
              <img src="imdblogo.png" alt="IMDb">
              <span id="imdb-rating"></span>
            </div>

            <div class="meta-tags">
              <div class="genres-container" id="genres"></div>
              <div class="duration-badge" id="duration">
                <svg class="clock-icon" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                </svg>
                <span id="movie-duration"></span>
                <span class="separator">‚Ä¢</span>
                <span id="release-year" class="year-badge"></span>
              </div>
            </div>
          </div>

          <p class="movie-description" id="movie-description"></p>

          <div class="action-buttons">
            <button class="primary-btn play-button" id="play-button">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M8 5v14l11-7z"/>
              </svg>
              Play Now
            </button>
            <button class="secondary-btn trailer-button" id="trailer-button">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
              </svg>
              Watch Trailer
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Actors Section -->
    <section class="content-section actors-section" id="actors">
      <div class="section-header">
        <h2 class="section-title">
          <span class="title-icon">üé≠</span>
          Cast & Crew
        </h2>
        <div class="section-actions">
          <button class="action-btn scroll-left" data-target="actors-grid">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>
          <button class="action-btn scroll-right" data-target="actors-grid">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
        </div>
      </div>
      <div class="content-scroller">
        <div class="actors-grid modern-grid" id="actors-grid">
          <!-- Actors will be inserted here -->
        </div>
      </div>
    </section>

    <!-- Collection Section -->
    <section class="content-section" id="collection">
      <div class="section-header">
        <h2 class="section-title">
          <span class="title-icon">üé¨</span>
          Collection
        </h2>
      </div>
      <div class="content-scroller">
        <div class="grid modern-grid" id="collection-grid">
          <!-- Collection items will be inserted here -->
        </div>
      </div>
    </section>

    <!-- Similar Movies/TV Shows Section -->
    <section class="content-section" id="similar">
      <div class="section-header">
        <h2 class="section-title">
          <span class="title-icon">üëç</span>
          Similar Movies/TV Shows
        </h2>
        <div class="section-actions">
          <button class="action-btn scroll-left" data-target="similar-grid">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>
          <button class="action-btn scroll-right" data-target="similar-grid">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
        </div>
      </div>
      <div class="content-scroller">
        <div class="grid modern-grid" id="similar-grid">
          <!-- Similar items will be inserted here -->
        </div>
      </div>
    </section>

    <!-- On The Air Section -->
    <section class="content-section" id="on-the-air">
      <div class="section-header">
        <h2 class="section-title">
          <span class="title-icon">üì∫</span>
          On The Air
        </h2>
        <div class="section-actions">
          <button class="action-btn scroll-left" data-target="on-the-air-grid">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>
          <button class="action-btn scroll-right" data-target="on-the-air-grid">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
        </div>
      </div>
      <div class="content-scroller">
        <div class="grid modern-grid" id="on-the-air-grid">
          <!-- On the air items will be inserted here -->
        </div>
      </div>
    </section>

    <!-- Recommendations Section -->
    <section class="content-section" id="recommendations">
      <div class="section-header">
        <h2 class="section-title">
          <span class="title-icon">‚≠ê</span>
          Recommendations
        </h2>
        <div class="section-actions">
          <button class="action-btn scroll-left" data-target="recommendations-grid">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>
          <button class="action-btn scroll-right" data-target="recommendations-grid">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
        </div>
      </div>
      <div class="content-scroller">
        <div class="grid modern-grid" id="recommendations-grid">
          <!-- Recommendations will be inserted here -->
        </div>
      </div>
    </section>
  </main>

  <!-- Trailer Modal -->
  <div class="modal-overlay" id="trailer-modal">
    <div class="modal-content trailer-content">
      <button class="modal-close" id="trailer-close">&times;</button>
      <div id="trailer-player"></div>
    </div>
  </div>

  <footer class="modern-footer">
    <div class="footer-content">
      <div class="footer-section">
        <h4>FireFlix</h4>
        <p>Stream your favorite movies and TV shows in HD quality.</p>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2024 FireFlix. All rights reserved.</p>
    </div>
  </footer>

  <script>
    const apiKey = '7967738a03ec215c7d6d675faba9c973';
    const urlParams = new URLSearchParams(window.location.search);
    const imdbId = urlParams.get('imdb_id');
    const playButton = document.getElementById('play-button');
    const trailerButton = document.getElementById('trailer-button');

    async function fetchMovieDetails(imdbId) {
      try {
        const findResponse = await fetch(`https://api.themoviedb.org/3/find/${imdbId}?api_key=${apiKey}&external_source=imdb_id`);
        const findData = await findResponse.json();
        let mediaType, tmdbId;

        if (findData.movie_results.length) {
          mediaType = 'movie';
          tmdbId = findData.movie_results[0].id;
        } else if (findData.tv_results.length) {
          mediaType = 'tv';
          tmdbId = findData.tv_results[0].id;
        } else {
          console.error("No movie or TV show found.");
          return;
        }

        const detailsResponse = await fetch(`https://api.themoviedb.org/3/${mediaType}/${tmdbId}?api_key=${apiKey}`);
        const movie = await detailsResponse.json();
        displayMovieDetails(movie, mediaType);
        fetchCollection(movie.belongs_to_collection);
        fetchAdditionalData(movie.id, mediaType);
        fetchActors(movie.id, mediaType);
      } catch (error) {
        console.error("Error fetching movie details: ", error);
      }
    }

    function displayMovieDetails(movie, mediaType) {
      const banner = document.getElementById('banner');
      const posterWrapper = document.getElementById('poster-wrapper');
      const movieTitle = document.getElementById('movie-title');
      const imdbRating = document.getElementById('imdb-rating');
      const movieDescription = document.getElementById('movie-description');
      const genresContainer = document.getElementById('genres');
      const movieDuration = document.getElementById('movie-duration');
      const releaseYear = document.getElementById('release-year');

      banner.style.backgroundImage = `url(https://image.tmdb.org/t/p/w1280${movie.backdrop_path || movie.poster_path})`;
      movieTitle.textContent = movie.title || movie.name;
      imdbRating.textContent = (movie.vote_average / 2).toFixed(1);
      movieDescription.textContent = movie.overview;

      // Poster
      posterWrapper.innerHTML = `
        <img src="https://image.tmdb.org/t/p/w500${movie.poster_path || movie.backdrop_path}"
             alt="${movie.title || movie.name}"
             class="poster-image">
      `;

      // Genres
      const knownGenres = [
        'Action', 'Adventure', 'Animation', 'Comedy', 'Crime', 'Documentary',
        'Drama', 'Family', 'Fantasy', 'History', 'Horror', 'Music', 'Mystery',
        'Romance', 'Science Fiction', 'TV Movie', 'Thriller', 'War', 'Western'
      ];

      genresContainer.innerHTML = '';
      const genres = movie.genres.map(genre => genre.name).filter(genre => knownGenres.includes(genre)).slice(0, 3);
      genres.forEach(genre => {
        const genreDiv = document.createElement('div');
        genreDiv.className = 'genre-tag';
        genreDiv.textContent = genre;
        genresContainer.appendChild(genreDiv);
      });

      // Duration and Year
      if (mediaType === 'movie' && movie.runtime) {
        const hours = Math.floor(movie.runtime / 60);
        const minutes = movie.runtime % 60;
        movieDuration.querySelector('span').textContent = hours > 0 ? `${hours}h ${minutes}m` : `${minutes}m`;
        releaseYear.textContent = movie.release_date ? new Date(movie.release_date).getFullYear() : 'N/A';
      } else if (mediaType === 'tv' && movie.number_of_episodes) {
        movieDuration.querySelector('span').textContent = `${movie.number_of_episodes} episodes`;
        releaseYear.textContent = movie.first_air_date ? new Date(movie.first_air_date).getFullYear() : 'N/A';
      }
    }

    async function fetchCollection(collection) {
      if (!collection) {
        document.getElementById('collection').style.display = 'none';
        return;
      }

      try {
        const response = await fetch(`https://api.themoviedb.org/3/collection/${collection.id}?api_key=${apiKey}`);
        const data = await response.json();
        displayCollection(data.parts);
      } catch (error) {
        console.error("Error fetching collection: ", error);
      }
    }

    function displayCollection(parts) {
      const collectionGrid = document.getElementById('collection-grid');
      collectionGrid.innerHTML = '';
      parts.forEach(part => {
        if (!part.poster_path && !part.backdrop_path) return;

        const div = document.createElement('div');
        const img = document.createElement('img');
        img.src = `https://image.tmdb.org/t/p/w500${part.poster_path || part.backdrop_path}`;
        img.alt = part.title || part.name;
        div.appendChild(img);

        div.addEventListener('click', async () => {
          const imdbId = await fetchIMDbID(part.id, part.media_type || 'movie');
          window.location.href = `movie.html?imdb_id=${imdbId}`;
        });

        collectionGrid.appendChild(div);
      });
    }

    async function fetchAdditionalData(movieId, mediaType) {
      await fetchSimilar(movieId, mediaType);
      await fetchOnTheAir();
      await fetchRecommendations(movieId, mediaType);
    }

    async function fetchActors(movieId, mediaType) {
      try {
        const response = await fetch(`https://api.themoviedb.org/3/${mediaType}/${movieId}/credits?api_key=${apiKey}`);
        const data = await response.json();
        displayActors(data.cast);
      } catch (error) {
        console.error("Error fetching actors: ", error);
      }
    }

    function displayActors(actors) {
      const actorsGrid = document.getElementById('actors-grid');
      actorsGrid.innerHTML = '';
      actors.filter(actor => actor.profile_path).forEach(actor => {
        const div = document.createElement('div');
        div.classList.add('actor-item');

        const img = document.createElement('img');
        img.src = `https://image.tmdb.org/t/p/w500${actor.profile_path}`;
        img.alt = actor.name;
        img.classList.add('actor-image');

        const name = document.createElement('p');
        name.textContent = actor.name;

        div.appendChild(img);
        div.appendChild(name);
        actorsGrid.appendChild(div);

        div.addEventListener('click', () => {
          window.location.href = `actors.html?actor_id=${actor.id}`;
        });
      });
    }

    async function fetchSimilar(movieId, mediaType) {
      try {
        const response = await fetch(`https://api.themoviedb.org/3/${mediaType}/${movieId}/similar?api_key=${apiKey}`);
        const data = await response.json();
        displayAdditionalContent(data.results, 'similar-grid');
      } catch (error) {
        console.error("Error fetching similar content: ", error);
      }
    }

    async function fetchOnTheAir() {
      try {
        const response = await fetch(`https://api.themoviedb.org/3/tv/on_the_air?api_key=${apiKey}`);
        const data = await response.json();
        displayAdditionalContent(data.results, 'on-the-air-grid');
      } catch (error) {
        console.error("Error fetching on-the-air content: ", error);
      }
    }

    async function fetchRecommendations(movieId, mediaType) {
      try {
        const response = await fetch(`https://api.themoviedb.org/3/${mediaType}/${movieId}/recommendations?api_key=${apiKey}`);
        const data = await response.json();
        displayAdditionalContent(data.results, 'recommendations-grid');
      } catch (error) {
        console.error("Error fetching recommendations: ", error);
      }
    }

    function displayAdditionalContent(items, containerId) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      items.forEach(item => {
        if (!item.poster_path && !item.backdrop_path) return;

        const div = document.createElement('div');
        const img = document.createElement('img');
        img.src = `https://image.tmdb.org/t/p/w500${item.poster_path || item.backdrop_path}`;
        img.alt = item.title || item.name;
        div.appendChild(img);

        div.addEventListener('click', async () => {
          const imdbId = await fetchIMDbID(item.id, item.media_type || (item.first_air_date ? 'tv' : 'movie'));
          window.location.href = `movie.html?imdb_id=${imdbId}`;
        });

        container.appendChild(div);
      });
    }

    async function fetchIMDbID(tmdbId, type) {
      try {
        const response = await fetch(`https://api.themoviedb.org/3/${type}/${tmdbId}/external_ids?api_key=${apiKey}`);
        const data = await response.json();
        return data.imdb_id;
      } catch (error) {
        console.error(`Error fetching IMDb ID for ${type} with TMDB ID ${tmdbId}: `, error);
      }
    }

    playButton.addEventListener('click', () => {
      saveToContinueWatching(imdbId);
      window.location.href = `player.html?imdb_id=${imdbId}`;
    });

    function saveToContinueWatching(imdbId) {
      let continueWatching = JSON.parse(localStorage.getItem('continueWatching')) || [];
      if (!continueWatching.includes(imdbId)) {
          continueWatching.push(imdbId);
          localStorage.setItem('continueWatching', JSON.stringify(continueWatching));
      }
    }

    trailerButton.addEventListener('click', async () => {
      const trailerUrl = await fetchTrailerUrl(imdbId);
      if (trailerUrl) {
        playTrailer(trailerUrl);
      }
    });

    async function fetchTrailerUrl(imdbId) {
      try {
        const findResponse = await fetch(`https://api.themoviedb.org/3/find/${imdbId}?api_key=${apiKey}&external_source=imdb_id`);
        const findData = await findResponse.json();
        let mediaType, tmdbId;

        if (findData.movie_results.length) {
          mediaType = 'movie';
          tmdbId = findData.movie_results[0].id;
        } else if (findData.tv_results.length) {
          mediaType = 'tv';
          tmdbId = findData.tv_results[0].id;
        } else {
          console.error("No movie or TV show found.");
          return null;
        }

        const trailerResponse = await fetch(`https://api.themoviedb.org/3/${mediaType}/${tmdbId}/videos?api_key=${apiKey}`);
        const trailerData = await trailerResponse.json();
        const trailer = trailerData.results.find(video => video.type === 'Trailer' && video.site === 'YouTube');
        return trailer ? `https://www.youtube.com/embed/${trailer.key}` : null;
      } catch (error) {
        console.error("Error fetching trailer: ", error);
        return null;
      }
    }

    function playTrailer(trailerUrl) {
      const modal = document.getElementById('trailer-modal');
      const player = document.getElementById('trailer-player');
      player.innerHTML = `
        <iframe src="${trailerUrl}"
                frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen>
        </iframe>
      `;
      modal.classList.add('active');
    }

    document.getElementById('trailer-close').addEventListener('click', () => {
      const modal = document.getElementById('trailer-modal');
      const player = document.getElementById('trailer-player');
      player.innerHTML = '';
      modal.classList.remove('active');
    });

    document.getElementById('trailer-modal').addEventListener('click', (e) => {
      if (e.target.id === 'trailer-modal') {
        const player = document.getElementById('trailer-player');
        player.innerHTML = '';
        e.target.classList.remove('active');
      }
    });

    // Initialize
    fetchMovieDetails(imdbId);
  </script>
</body>
</html>
