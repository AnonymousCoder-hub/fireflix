<!DOCTYPE html>
<html lang="en">
<head>


<script type="text/javascript" data-cfasync="false">
/*<![CDATA[/* */
(function(){var b=window,n="fab280e2ca6fed377c48e81e9221a44c",d=[["siteId",780+176*417*347-20267182],["minBid",0],["popundersPerIP","0"],["delayBetween",0],["default",false],["defaultPerDay",0],["topmostLayer","auto"]],e=["d3d3LmNkbjRhZHMuY29tL2lUelNFL3hhbGVydGlmeS5taW4uanM=","ZDNnNW92Zm5nanc5YncuY2xvdWRmcm9udC5uZXQvVEdpT00veFhaYVZiL2lwYXJzZS5taW4uY3Nz"],m=-1,h,p,j=function(){clearTimeout(p);m++;if(e[m]&&!(1773409244000<(new Date).getTime()&&1<m)){h=b.document.createElement("script");h.type="text/javascript";h.async=!0;var q=b.document.getElementsByTagName("script")[0];h.src="https://"+atob(e[m]);h.crossOrigin="anonymous";h.onerror=j;h.onload=function(){clearTimeout(p);b[n.slice(0,16)+n.slice(0,16)]||j()};p=setTimeout(j,5E3);q.parentNode.insertBefore(h,q)}};if(!b[n]){try{Object.freeze(b[n]=d)}catch(e){}j()}})();
/*]]>/* */
</script>


  
  
  <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-0Q1VZ5TT2T"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-0Q1VZ5TT2T');
    </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Movie Details</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="styles3.css">
</head>
<body>
        

  <header>
    <nav>
      <a href="index.html">Home</a>
    </nav>
  </header>

  <main>
    <div class="banner" id="banner">
      <div class="banner-overlay"></div>
      <div class="small-banner" id="small-banner"></div>
    </div>
    <div class="movie-details">
      <div class="rating">
        <img src="imdblogo.png" alt="IMDb Logo">
        <span id="imdb-rating"></span>
      </div>
      <div class="genres-duration-container">
        <div class="genres" id="genres"></div>
        <span id="duration">
          <img src="clock.png" alt="Clock Icon" id="clock-icon">
          <span id="movie-duration"></span>
          <span> â€¢ </span>
          <span id="release-year" class="release-year"></span>
        </span>
      </div>
      <p id="movie-description"></p>
      <div class="buttons">
        <button class="play-button" id="play-button">Play</button>
        <button class="trailer-button" id="trailer-button">Trailer</button>
      </div>
    </div>

    <!-- Actors Section -->
    <section class="content-section" id="actors">
      <h2 class="category-title" id="actors-title">
        <span class="vertical-line"></span>Actors
      </h2>
      <div class="actors-carousel-wrapper">
        <div class="carousel-control left" id="left-arrow">&#9664;</div>
        <div class="actors-carousel" id="actors-carousel">
          <div class="actors-grid" id="actors-grid"></div>
        </div>
        <div class="carousel-control right" id="right-arrow">&#9654;</div>
      </div>
    </section>

    <!-- Collection Section -->
    <section class="content-section" id="collection">
      <h2 class="category-title" id="collection-title">
        <span class="vertical-line"></span>Collection
      </h2>
      <div class="grid" id="collection-grid"></div>
    </section>

    <!-- Similar Movies/TV Shows Section -->
    <section class="content-section" id="similar">
      <h2 class="category-title" id="similar-title">
        <span class="vertical-line"></span>Similar Movies/TV Shows
      </h2>
      <div class="grid" id="similar-grid"></div>
    </section>

    <!-- On The Air Section -->
    <section class="content-section" id="on-the-air">
      <h2 class="category-title" id="on-the-air-title">
        <span class="vertical-line"></span>On The Air
      </h2>
      <div class="grid" id="on-the-air-grid"></div>
    </section>

    <!-- Recommendations Section -->
    <section class="content-section" id="recommendations">
      <h2 class="category-title" id="recommendations-title">
        <span class="vertical-line"></span>Recommendations
      </h2>
      <div class="grid" id="recommendations-grid"></div>
    </section>
  </main>

  <footer>
    <p>&copy; 2024 FireFlix. All rights reserved.</p>
  </footer>

  <script>
    const apiKey = '7967738a03ec215c7d6d675faba9c973';
    const urlParams = new URLSearchParams(window.location.search);
    const imdbId = urlParams.get('imdb_id');
    const playButton = document.getElementById('play-button');
    const trailerButton = document.getElementById('trailer-button');

    async function fetchMovieDetails(imdbId) {
      try {
        const findResponse = await fetch(`https://api.themoviedb.org/3/find/${imdbId}?api_key=${apiKey}&external_source=imdb_id`);
        const findData = await findResponse.json();
        let mediaType, tmdbId;

        if (findData.movie_results.length) {
          mediaType = 'movie';
          tmdbId = findData.movie_results[0].id;
        } else if (findData.tv_results.length) {
          mediaType = 'tv';
          tmdbId = findData.tv_results[0].id;
        } else {
          console.error("No movie or TV show found.");
          return;
        }

        const detailsResponse = await fetch(`https://api.themoviedb.org/3/${mediaType}/${tmdbId}?api_key=${apiKey}`);
        const movie = await detailsResponse.json();
        displayMovieDetails(movie, mediaType);
        fetchCollection(movie.belongs_to_collection);
        fetchAdditionalData(movie.id, mediaType);
        fetchActors(movie.id, mediaType);
      } catch (error) {
        console.error("Error fetching movie details: ", error);
      }
    }

    function displayMovieDetails(movie, mediaType) {
      const banner = document.getElementById('banner');
      const imdbRating = document.getElementById('imdb-rating');
      const movieDescription = document.getElementById('movie-description');
      const smallBanner = document.getElementById('small-banner');
      const genresContainer = document.getElementById('genres');
      const movieDuration = document.getElementById('movie-duration');
      const releaseYear = document.getElementById('release-year');
      const clockIcon = document.getElementById('clock-icon');

      banner.style.backgroundImage = `url(https://image.tmdb.org/t/p/w1280${movie.backdrop_path || movie.poster_path})`;
      imdbRating.textContent = movie.vote_average || 'N/A';
      movieDescription.textContent = movie.overview;

      const knownGenres = [
        'Action', 'Adventure', 'Animation', 'Comedy', 'Crime', 'Documentary',
        'Drama', 'Family', 'Fantasy', 'History', 'Horror', 'Music', 'Mystery',
        'Romance', 'Science Fiction', 'TV Movie', 'Thriller', 'War', 'Western'
      ];

      genresContainer.innerHTML = '';
      const genres = movie.genres.map(genre => genre.name).filter(genre => knownGenres.includes(genre)).slice(0, 3);
      genres.forEach(genre => {
        const genreDiv = document.createElement('div');
        genreDiv.className = 'genre';
        genreDiv.textContent = genre;
        genresContainer.appendChild(genreDiv);
      });

      smallBanner.style.backgroundImage = `url(https://image.tmdb.org/t/p/w500${movie.poster_path || movie.backdrop_path})`;

      // Add the duration and release year
      if (mediaType === 'movie' && movie.runtime) {
        clockIcon.style.display = 'inline';
        const hours = Math.floor(movie.runtime / 60);
        const minutes = movie.runtime % 60;
        movieDuration.textContent = hours > 0 ? `${hours}h ${minutes}m` : `${minutes}m`;
        releaseYear.textContent = movie.release_date ? new Date(movie.release_date).getFullYear() : 'N/A';
      } else if (mediaType === 'tv' && movie.number_of_episodes) {
        clockIcon.style.display = 'none';
        movieDuration.textContent = `${movie.number_of_episodes} episodes`;
        releaseYear.textContent = movie.first_air_date ? new Date(movie.first_air_date).getFullYear() : 'N/A';
      } else {
        clockIcon.style.display = 'none';
        movieDuration.textContent = 'N/A';
        releaseYear.textContent = 'N/A';
      }
    }

    async function fetchCollection(collection) {
      if (!collection) {
        document.getElementById('collection').style.display = 'none';
        return;
      }

      try {
        const response = await fetch(`https://api.themoviedb.org/3/collection/${collection.id}?api_key=${apiKey}`);
        const data = await response.json();
        displayCollection(data.parts);
      } catch (error) {
        console.error("Error fetching collection: ", error);
      }
    }

    function displayCollection(parts) {
      const collectionGrid = document.getElementById('collection-grid');
      collectionGrid.innerHTML = '';
      parts.forEach(part => {
        if (!part.poster_path && !part.backdrop_path) return;

        const div = document.createElement('div');
        const img = document.createElement('img');
        img.src = `https://image.tmdb.org/t/p/w500${part.poster_path || part.backdrop_path}`;
        img.alt = part.title || part.name;
                div.appendChild(img);

        div.addEventListener('click', async () => {
          const imdbId = await fetchIMDbID(part.id, part.media_type || 'movie');
          window.location.href = `movie.html?imdb_id=${imdbId}`;
        });

        collectionGrid.appendChild(div);
      });
    }

    async function fetchAdditionalData(movieId, mediaType) {
      await fetchSimilar(movieId, mediaType);
      await fetchOnTheAir();
      await fetchRecommendations(movieId, mediaType);
    }

    async function fetchActors(movieId, mediaType) {
      try {
        const response = await fetch(`https://api.themoviedb.org/3/${mediaType}/${movieId}/credits?api_key=${apiKey}`);
        const data = await response.json();
        displayActors(data.cast);
      } catch (error) {
        console.error("Error fetching actors: ", error);
      }
    }

    function displayActors(actors) {
      const actorsGrid = document.getElementById('actors-grid');
      actorsGrid.innerHTML = '';
      actors.filter(actor => actor.profile_path).forEach(actor => {
        const div = document.createElement('div');
        div.classList.add('actor-item');

        const img = document.createElement('img');
        img.src = `https://image.tmdb.org/t/p/w500${actor.profile_path}`;
        img.alt = actor.name;
        img.classList.add('actor-image');

        const name = document.createElement('p');
        name.textContent = actor.name;

        div.appendChild(img);
        div.appendChild(name);
        actorsGrid.appendChild(div);

        div.addEventListener('click', () => {
          window.location.href = `actors.html?actor_id=${actor.id}`;
        });
      });

      const carousel = document.getElementById('actors-carousel');
      const leftArrow = document.getElementById('left-arrow');
      const rightArrow = document.getElementById('right-arrow');

      leftArrow.addEventListener('click', () => {
        carousel.scrollBy({
          left: -200,
          behavior: 'smooth'
        });
      });

      rightArrow.addEventListener('click', () => {
        carousel.scrollBy({
          left: 200,
          behavior: 'smooth'
        });
      });
    }

    async function fetchSimilar(movieId, mediaType) {
      try {
        const response = await fetch(`https://api.themoviedb.org/3/${mediaType}/${movieId}/similar?api_key=${apiKey}`);
        const data = await response.json();
        displayAdditionalContent(data.results, 'similar-grid');
      } catch (error) {
        console.error("Error fetching similar content: ", error);
      }
    }

    async function fetchOnTheAir() {
      try {
        const response = await fetch(`https://api.themoviedb.org/3/tv/on_the_air?api_key=${apiKey}`);
        const data = await response.json();
        displayAdditionalContent(data.results, 'on-the-air-grid');
      } catch (error) {
        console.error("Error fetching on-the-air content: ", error);
      }
    }

    async function fetchRecommendations(movieId, mediaType) {
      try {
        const response = await fetch(`https://api.themoviedb.org/3/${mediaType}/${movieId}/recommendations?api_key=${apiKey}`);
        const data = await response.json();
        displayAdditionalContent(data.results, 'recommendations-grid');
      } catch (error) {
        console.error("Error fetching recommendations: ", error);
      }
    }

    function displayAdditionalContent(items, containerId) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      items.forEach(item => {
        if (!item.poster_path && !item.backdrop_path) return;

        const div = document.createElement('div');
        const img = document.createElement('img');
        img.src = `https://image.tmdb.org/t/p/w500${item.poster_path || item.backdrop_path}`;
        img.alt = item.title || item.name;
        div.appendChild(img);

        div.addEventListener('click', async () => {
          const imdbId = await fetchIMDbID(item.id, item.media_type || (item.first_air_date ? 'tv' : 'movie'));
          window.location.href = `movie.html?imdb_id=${imdbId}`;
        });

        container.appendChild(div);
      });
    }

    async function fetchIMDbID(tmdbId, type) {
      try {
        const response = await fetch(`https://api.themoviedb.org/3/${type}/${tmdbId}/external_ids?api_key=${apiKey}`);
        const data = await response.json();
        return data.imdb_id;
      } catch (error) {
        console.error(`Error fetching IMDb ID for ${type} with TMDB ID ${tmdbId}: `, error);
      }
    }

    playButton.addEventListener('click', () => {
      saveToContinueWatching(imdbId);
      window.location.href = `player.html?imdb_id=${imdbId}`;
    });

    // Function to save the TMDb ID to local storage
    function saveToContinueWatching(imdbId) {
      let continueWatching = JSON.parse(localStorage.getItem('continueWatching')) || [];

      // Add the new TMDb ID to the list if it's not already there
      if (!continueWatching.includes(imdbId)) {
          continueWatching.push(imdbId);
          localStorage.setItem('continueWatching', JSON.stringify(continueWatching));
      }
    }

    trailerButton.addEventListener('click', async () => {
      const trailerUrl = await fetchTrailerUrl(imdbId);
      if (trailerUrl) {
        playTrailer(trailerUrl);
      }

      if (window.innerWidth <= 768) {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    });

    async function fetchTrailerUrl(imdbId) {
      try {
        const findResponse = await fetch(`https://api.themoviedb.org/3/find/${imdbId}?api_key=${apiKey}&external_source=imdb_id`);
        const findData = await findResponse.json();
        let mediaType, tmdbId;

        if (findData.movie_results.length) {
          mediaType = 'movie';
          tmdbId = findData.movie_results[0].id;
        } else if (findData.tv_results.length) {
          mediaType = 'tv';
          tmdbId = findData.tv_results[0].id;
        } else {
          console.error("No movie or TV show found.");
          return null;
        }

        const trailerResponse = await fetch(`https://api.themoviedb.org/3/${mediaType}/${tmdbId}/videos?api_key=${apiKey}`);
        const trailerData = await trailerResponse.json();
        const trailer = trailerData.results.find(video => video.type === 'Trailer' && video.site === 'YouTube');
        return trailer ? `https://www.youtube.com/embed/${trailer.key}` : null;
      } catch (error) {
        console.error("Error fetching trailer: ", error);
        return null;
      }
    }

    function playTrailer(trailerUrl) {
      const banner = document.getElementById('banner');
      const smallBanner = document.getElementById('small-banner');

      smallBanner.classList.add('small-banner-down');
      if (window.innerWidth > 768) {
        banner.style.height = '80vh';
      }

      banner.innerHTML = `<iframe width="100%" height="100%" src="${trailerUrl}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
    }

    if (imdbId) {
      fetchMovieDetails(imdbId);
    }
  </script>
</body>
</html>