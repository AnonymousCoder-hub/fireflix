<!DOCTYPE html>
<html lang="en">
<head>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-0Q1VZ5TT2T"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-0Q1VZ5TT2T');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Results</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="styles2.css">
</head>
<body>
    <header>
        <nav>
            <a href="index.html">Home</a>
        </nav>
    </header>
    
    <main>
        <h1>Search Results</h1>
        <div class="underline"></div>
        <div id="search-results-container" class="search-results-grid"></div>
    </main>
    
    <footer>
        <p>&copy; 2024 FireFlix. All rights reserved.</p>
    </footer>

    <script>
        const apiKey = '7967738a03ec215c7d6d675faba9c973';
        const searchResultsContainer = document.getElementById('search-results-container');

        async function fetchAndDisplaySearchResults(query) {
            try {
                const response = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${apiKey}&query=${query}`);
                const data = await response.json();
                if (data.results.length) {
                    displaySearchResults(data.results, searchResultsContainer);
                } else {
                    console.error("No search results available.");
                }
            } catch (error) {
                console.error("Error fetching search results: ", error);
            }
        }

        const urlParams = new URLSearchParams(window.location.search);
        const query = urlParams.get('query');
        if (query) {
            fetchAndDisplaySearchResults(query);
        }

        function displaySearchResults(items, container) {
            container.innerHTML = '';
            items.forEach(item => {
                if (!item.poster_path && !item.backdrop_path) return; // Skip items without images

                const div = document.createElement('div');
                div.classList.add('search-result-item');

                const img = document.createElement('img');
                img.src = `https://image.tmdb.org/t/p/w500${item.poster_path || item.backdrop_path}`;
                img.alt = item.title || item.name;

                const title = document.createElement('h3');
                title.textContent = item.title || item.name;

                div.appendChild(img);
                div.appendChild(title);
                container.appendChild(div);

                const type = item.media_type || (item.first_air_date ? 'tv' : 'movie');
                div.addEventListener('click', async () => {
                    const imdbId = await fetchIMDbID(item.id, type);
                    window.location.href = `movie.html?imdb_id=${imdbId}`;
                });
            });
        }

        async function fetchIMDbID(tmdbId, type) {
            try {
                const response = await fetch(`https://api.themoviedb.org/3/${type}/${tmdbId}/external_ids?api_key=${apiKey}`);
                const data = await response.json();
                return data.imdb_id;
            } catch (error) {
                console.error(`Error fetching IMDb ID for ${type} with TMDB ID ${tmdbId}: `, error);
            }
        }
    </script>
</body>
</html>
